!function(t){function r(e){if(n[e])return n[e].exports;var o=n[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var n={};return r.m=t,r.c=n,r.p="",r(0)}([function(t,r){function n(){return{things:[new c(new i(0,1,0),0,o.checkerboard),new a(new i(0,1,-.25),1,o.shiny),new a(new i(-1,.5,1.5),.5,o.shiny)],lights:[{pos:new i(-2,2.5,0),color:new u(.49,.07,.07)},{pos:new i(1.5,2.5,1.5),color:new u(.07,.07,.49)},{pos:new i(1.5,2.5,-1.5),color:new u(.07,.49,.071)},{pos:new i(0,3.5,0),color:new u(.21,.21,.35)}],camera:new s(new i(3,2,4),new i(-1,.5,0))}}function e(){var t=document.createElement("canvas");t.width=256,t.height=256,document.getElementById("hello").appendChild(t);var r=t.getContext("2d"),e=new f;return e.render(n(),r,256,256)}var o,i=function(){function t(t,r,n){this.x=t,this.y=r,this.z=n}return t.times=function(r,n){return new t(r*n.x,r*n.y,r*n.z)},t.minus=function(r,n){return new t(r.x-n.x,r.y-n.y,r.z-n.z)},t.plus=function(r,n){return new t(r.x+n.x,r.y+n.y,r.z+n.z)},t.dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z},t.mag=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},t.norm=function(r){var n=t.mag(r),e=0===n?1/0:1/n;return t.times(e,r)},t.cross=function(r,n){return new t(r.y*n.z-r.z*n.y,r.z*n.x-r.x*n.z,r.x*n.y-r.y*n.x)},t}(),u=function(){function t(t,r,n){this.r=t,this.g=r,this.b=n}return t.scale=function(r,n){return new t(r*n.r,r*n.g,r*n.b)},t.plus=function(r,n){return new t(r.r+n.r,r.g+n.g,r.b+n.b)},t.times=function(r,n){return new t(r.r*n.r,r.g*n.g,r.b*n.b)},t.toDrawingColor=function(t){var r=function(t){return t>1?1:t};return{r:Math.floor(255*r(t.r)),g:Math.floor(255*r(t.g)),b:Math.floor(255*r(t.b))}},t.white=new t(1,1,1),t.grey=new t(.5,.5,.5),t.black=new t(0,0,0),t.background=t.black,t.defaultColor=t.black,t}(),s=function(){function t(t,r){this.pos=t;var n=new i(0,-1,0);this.forward=i.norm(i.minus(r,this.pos)),this.right=i.times(1.5,i.norm(i.cross(this.forward,n))),this.up=i.times(1.5,i.norm(i.cross(this.forward,this.right)))}return t}(),a=function(){function t(t,r,n){this.center=t,this.surface=n,this.radius2=r*r}return t.prototype.normal=function(t){return i.norm(i.minus(t,this.center))},t.prototype.intersect=function(t){var r=i.minus(this.center,t.start),n=i.dot(r,t.dir),e=0;if(n>=0){var o=this.radius2-(i.dot(r,r)-n*n);o>=0&&(e=n-Math.sqrt(o))}return 0===e?null:{thing:this,ray:t,dist:e}},t}(),c=function(){function t(t,r,n){this.surface=n,this.normal=function(r){return t},this.intersect=function(n){var e=i.dot(t,n.dir);if(e>0)return null;var o=(i.dot(t,n.start)+r)/-e;return{thing:this,ray:n,dist:o}}}return t}();!function(t){t.shiny={diffuse:function(t){return u.white},specular:function(t){return u.grey},reflect:function(t){return.7},roughness:250},t.checkerboard={diffuse:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?u.white:u.black},specular:function(t){return u.white},reflect:function(t){return(Math.floor(t.z)+Math.floor(t.x))%2!==0?.1:.7},roughness:150}}(o||(o={}));var f=function(){function t(){this.maxDepth=5}return t.prototype.intersections=function(t,r){var n=+(1/0),e=void 0;for(var o in r.things){var i=r.things[o].intersect(t);null!=i&&i.dist<n&&(e=i,n=i.dist)}return e},t.prototype.testRay=function(t,r){var n=this.intersections(t,r);return null!=n?n.dist:void 0},t.prototype.traceRay=function(t,r,n){var e=this.intersections(t,r);return void 0===e?u.background:this.shade(e,r,n)},t.prototype.shade=function(t,r,n){var e=t.ray.dir,o=i.plus(i.times(t.dist,e),t.ray.start),s=t.thing.normal(o),a=i.minus(e,i.times(2,i.times(i.dot(s,e),s))),c=u.plus(u.background,this.getNaturalColor(t.thing,o,s,a,r)),f=n>=this.maxDepth?u.grey:this.getReflectionColor(t.thing,o,s,a,r,n);return u.plus(c,f)},t.prototype.getReflectionColor=function(t,r,n,e,o,i){return u.scale(t.surface.reflect(r),this.traceRay({start:r,dir:e},o,i+1))},t.prototype.getNaturalColor=function(t,r,n,e,o){var s=this,a=function(a,c){var f=i.minus(c.pos,r),l=i.norm(f),h=s.testRay({start:r,dir:l},o),d=void 0===h?!1:h<=i.mag(f);if(d)return a;var p=i.dot(l,n),g=p>0?u.scale(p,c.color):u.defaultColor,m=i.dot(l,i.norm(e)),w=m>0?u.scale(Math.pow(m,t.surface.roughness),c.color):u.defaultColor;return u.plus(a,u.plus(u.times(t.surface.diffuse(r),g),u.times(t.surface.specular(r),w)))};return o.lights.reduce(a,u.defaultColor)},t.prototype.render=function(t,r,n,e){for(var o=function(t,r,o){var u=function(t){return(t-n/2)/2/n},s=function(t){return-(t-e/2)/2/e};return i.norm(i.plus(o.forward,i.plus(i.times(u(t),o.right),i.times(s(r),o.up))))},s=0;e>s;s++)for(var a=0;n>a;a++){var c=this.traceRay({start:t.camera.pos,dir:o(a,s,t.camera)},t,0),f=u.toDrawingColor(c);r.fillStyle="rgb("+String(f.r)+", "+String(f.g)+", "+String(f.b)+")",r.fillRect(a,s,a+1,s+1)}},t}();e()}]);